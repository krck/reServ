<!DOCTYPE html>
<html>

<head>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
    }

    h1 {
      margin-bottom: 20px;
    }

    #message-input {
      margin-right: 10px;
    }

    #buttons {
      margin-bottom: 20px;
    }

    #outputs {
      margin-bottom: 20px;
      color: red;
    }

    button {
      padding: 5px 5px;
      margin: 5px;
      background-color: #007bff;
      color: #fff;
      border: none;
      cursor: pointer;
    }

    button:hover {
      background-color: #0056b3;
    }

    p {
      margin: 0;
      font-size: small;
    }
  </style>
</head>

<body>
  <!-- HTML Content -->
  <div>
    <h1>WebSocket Test Client</h1>
    <button id="websocket-button">Connect to WebSocket</button>
    <form id="message-form">
      <input type="text" id="message-input" placeholder="Type your message">
      <button type="submit">Send</button>
    </form>
    <div id="outputs"></div>
  </div>

  <!-- JavaScript Code -->
  <script>
    let socket;
    document.getElementById('websocket-button').addEventListener('click', () => {
      try {
        socket = new WebSocket('ws://127.0.0.1:8080');
        displayOutput('WebSocket created', null, 'black');
      } catch (error) {
        displayOutput('WebSocket creation failed', error, 'red');
        return;
      }

      socket.addEventListener('open', (event) => { displayOutput('WebSocket connection opened', event, 'black'); });
      socket.addEventListener('message', (event) => { displayOutput('Recieved: ', event.data, 'green'); });
      socket.addEventListener('error', (event) => {
        if (socket.readyState !== WebSocket.OPEN) {
          displayOutput('WebSocket is not open. Current state:', socket.readyState, 'red');
        }
        displayOutput('WebSocket error occurred', event, 'red');
      });
      socket.addEventListener('close', (event) => {
        displayOutput('WebSocket connection closed', event, 'black');
        document.getElementById('websocket-button').disabled = false;
      });

      document.getElementById('websocket-button').disabled = true;
    });

    document.getElementById('message-form').addEventListener('submit', (event) => {
      event.preventDefault(); // Prevent the form from submitting normally
      const messageInput = document.getElementById('message-input');
      const message = messageInput.value;
      if (socket && socket.readyState === WebSocket.OPEN) {
        socket.send(message);
        displayOutput('Sent: ', message, 'green');
        messageInput.value = ''; // Clear the input field
      } else {
        displayOutput('Cannot send message, WebSocket is not open', null, 'red');
      }
    });

    function displayOutput(outputStr, outputObj, color) {
      const outputsDiv = document.getElementById('outputs');
      const outputElement = document.createElement('p');

      let output = outputStr;
      if (typeof outputObj === 'object' && outputObj !== null) {
        output += (": " + JSON.stringify(outputObj));
      } else if (outputObj !== undefined) {
        output += (": " + outputObj);
      }

      // Format the timestamp. This will give a format like: [HH:MM:SS]
      const timestamp = new Date();
      const formattedTimestamp = '[' +
        timestamp.getHours().toString().padStart(2, '0') + ':' +
        timestamp.getMinutes().toString().padStart(2, '0') + ':' +
        timestamp.getSeconds().toString().padStart(2, '0') +
        ']: ';

      // Add the timestamp to the output
      output = formattedTimestamp + output;

      outputElement.style.color = color;
      outputElement.textContent = output;
      outputsDiv.appendChild(outputElement);
      console.log(outputStr, outputObj);
    }
  </script>
</body>

</html>